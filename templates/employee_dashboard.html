<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Nhân Viên</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .filter-form { flex-direction: row; justify-content: center; }
        @media (max-width: 768px) { .filter-form { flex-direction: column; } }
    </style>
</head>
<body>
    <header>
        <div class="nav-container">
            <div class="nav-brand">
                <a href="{{ url_for('employee_dashboard') }}">HỆ THỐNG CHẤM CÔNG</a>
            </div>
            <div class="nav-links">
                <a href="{{ url_for('checkin') }}">Chấm Công</a>
                <a href="{{ url_for('leave_request') }}">Xin Nghỉ Phép</a>
                <a href="{{ url_for('work_report') }}">Báo Cáo Công Việc</a>
                <a href="{{ url_for('logout') }}">Đăng Xuất</a>
            </div>
        </div>
    </header>
    <main>
        <div class="section">
            <h1>Dashboard Nhân Viên</h1>
            <form method="POST" class="filter-form">
                <label>Lọc:</label>
                <select name="filter_type" onchange="toggleMonthInput(this)">
                    <option value="week" {% if filter_type == 'week' %}selected{% endif %}>7 Ngày Gần Nhất</option>
                    <option value="month" {% if filter_type == 'month' %}selected{% endif %}>Theo Tháng</option>
                </select>
                <input type="month" name="selected_month" id="month_input" value="{{ selected_month }}"
                       {% if filter_type != 'month' %}style="display:none;"{% endif %}>
                <button type="submit">Xem</button>
            </form>
        </div>
        <div class="section">
            <h2>Lịch Sử Chấm Công</h2>
            <table>
                <thead>
                    <tr>
                        <th>Ngày</th>
                        <th colspan="2">Buổi Sáng</th>
                        <th colspan="2">Buổi Chiều</th>
                        <th>Ghi chú</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th>Check-in</th>
                        <th>Check-out</th>
                        <th>Check-in</th>
                        <th>Check-out</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for date, records in daily_records.items() %}
                    <tr>
                        <td>{{ date }}</td>
                        <td>
                            {{ records.in_morning.time or '' }}
                            {% if records.in_morning.photo %}
                            <br><img src="{{ url_for('static', filename=records.in_morning.photo[7:]) }}" alt="Photo" class="photo">
                            {% endif %}
                        </td>
                        <td>
                            {{ records.out_morning.time or '' }}
                            {% if records.out_morning.photo %}
                            <br><img src="{{ url_for('static', filename=records.out_morning.photo[7:]) }}" alt="Photo" class="photo">
                            {% endif %}
                        </td>
                        <td>
                            {{ records.in_afternoon.time or '' }}
                            {% if records.in_afternoon.photo %}
                            <br><img src="{{ url_for('static', filename=records.in_afternoon.photo[7:]) }}" alt="Photo" class="photo">
                            {% endif %}
                        </td>
                        <td>
                            {{ records.out_afternoon.time or '' }}
                            {% if records.out_afternoon.photo %}
                            <br><img src="{{ url_for('static', filename=records.out_afternoon.photo[7:]) }}" alt="Photo" class="photo">
                            {% endif %}
                        </td>
                        <td>{% if records.reason %}<span class="reason">{{ records.reason }}</span>{% endif %}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="section">
            <h2>Danh Sách Đơn Xin Nghỉ Phép</h2>
            <table>
                <thead>
                    <tr>
                        <th>Ngày Gửi</th>
                        <th>Ngày Nghỉ</th>
                        <th>Loại Nghỉ</th>
                        <th>Lý Do</th>
                        <th>Trạng Thái</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in leave_requests %}
                    <tr>
                        <td>{{ req[0] }}</td>
                        <td>{{ req[1] }}</td>
                        <td>{{ req[2] }}</td>
                        <td>{{ req[3] }}</td>
                        <td class="{% if req[4] == 'Được duyệt' %}approved{% elif req[4] == 'Từ chối' %}rejected{% endif %}">{{ req[4] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="section">
            <h2>Danh Sách Báo Cáo Công Việc</h2>
            <table>
                <thead>
                    <tr>
                        <th>Ngày Gửi</th>
                        <th>Nội Dung</th>
                        <th>Đính Kèm</th>
                    </tr>
                </thead>
                <tbody>
                    {% for report in reports %}
                    <tr>
                        <td>{{ report[0] }}</td>
                        <td>{{ report[1] }}</td>
                        <td>{% if report[2] %}<a href="{{ url_for('static', filename=report[2][7:]) }}" target="_blank" class="attachment">Xem</a>{% else %}Không có{% endif %}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>
    <script>
        function toggleMonthInput(select) {
            const monthInput = document.getElementById('month_input');
            monthInput.style.display = select.value === 'month' ? 'inline-block' : 'none';
        }
    </script>
</body>
</html>